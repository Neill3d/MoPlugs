
16.11.16

 + added xml presets file which is used by MoSettings object and main MoSettings menu
 + сцена 01_HARE_TEL_A_BEACH_UMBRELLA_LOOK_003
 даже при условии use play time всё равно сцена подвисает при активном Camera Processing Stage 
	оказалось что даже когда камера не требовала обновления (рендера) всё равно производилась подготовка матриц и шейдера для всех объектов
	if (pCubeMap->Enabled == false || pCubeMap->IsNeedUpdate() == false)
			continue;
	перенес это выше по коду и стало легче дышать в кадре.

14.11.16

 + DOF не работает корректно в Log depth - сцена compositionDOF2.fbx
	проблема была в том, что не назначен projtex shader на объекты
 - UI требует обновления, перемещение, копирование, в особенности касательно моделей (Model Decal, Volume Fog) не работает
 - something weird with the alpha. Sometimes need a 235% opacity to have a correct looking Normal blend mode
 - 3d volume fog and 3d decal filters - has shift when camera moves / rotates !!!
 - add photoshop path into the config file
 - check composition copy, filters copy
 - check decal models move and copy, fog markers move and copy
 - linked groups(objects) to composition

 + Добавить авто включение preview mode во время вращения камеры или во время проигрывания анимации
 + добавить авто выключение preview во время рендера !
 + добавить удобное меню для управления настройками графики (сглаживание, глубина, preview,
 processing stages)
 + добавить hue для decal model

13.11.16

 + обновил работу предварительного просмотра для fog, decal, ssao
	+ 3d fog filter and 3d decal filter doesn't work correctly in a preview mode
 + в preview сбивается DOF, также preview blur mode выдается ошибка
 - проверить работу остальных фильтров в preview mode

 + создание копии для volume fog, decal model
 + заработал SSAO фильтер (правда производительность его оставляет желать лучшего)
	возможно для SSAO следует использовать разрешение в два или 4 раза меньше и затем через небольшой блюр накладывать его
	Таким же образом, как сейчас работает DOF фильтр в preview режиме

+ не работает выделение объектов в режиме цветового выделения !

11.11.16

 composition linked groups - I think to make two set of groups (groups to show, groups to hide)
	and that means we have to track when composition is active and turn Non Active

 + when tweak field of view - 3d fog also affected !
 + What would be nice sergey is if I could adjust hue sat bright contrast per decal ?
 

 + add a support for log depth for the decal models
 + add a support for log depth for the fog volume model
 + add a support for log depth for the fog target model

 + create volume in camera position
 + make volume bigger from the beginning
 

08.11.16

 + check global resolution and facial camera resolution !!! think about other camera-resolution connections
 
 + make feather to zero by default
 + resolution for global rendering (aspect 2.35 - 2274x967)

 start working on MatCap shading and render conveyer

 Было бы здорово для добавления деталей в сцену и воизбежании порождения огромного количества текстур и фильтров
 !!! ИСПОЛЬЗОВАТЬ ТЕКСТУРНЫЕ АТЛАСЫ и потом части атласа проецировать через орто вид !!!

 Также очень важно в итоге научиться строить проекционные матрицы и не обращаться за этим каждый раз к камере !

 Удалось сохранить для decal правильный размер картинки и обрезать пустые поля, масштабировать до полного размера рендера.
+ Теперь что-то криво проецируется. Это камень на пути. 

 + Далее идут поддержка нескольких декал, 
 + сохранение матриц или написать рабочий код по подготовке матриц из значения свойств
 + свойства каждого декала (режим смешивания, прозрачность)

 Note! bindless texture конфликтует с моби. Любой вызов OGLInit в текстуре приводит к ошибке,
 потому как если адрес на текстуру + сэмплер получен, их нельзя менять (за исключением glTexSubImage)
 А моби в вызове OGLInit меняет значения сэмплера, если это обойти можно побороться.
  Другое дело что нужно отслеживать изменение клипа или перезагрузку клипа. Пока точно не разобрался
  что происходит в этом случае, если удаляет текстуру, то просто заново получить адрес. Если
  использует glTexImage - будет ошибка, с которой не поборешься уже !

07.11.16

 + Первая серьезная проблема. Decal рисуется для картинки в экран, но это не соответствует целевой картинке экрана. Например нам нужно рисовать в 2k, у нас есть Aspect, но в видовом окне это 800хN, тогда получается что мы нарисуем небольшой декал, который будет низкого разрешение по отношению с реальным размером конечного рендера.

 В стандартном видовом окне я не могу рисовать картинку большего размера, хотя в финальном рендере она будет больше. Отсюда вытекает что можно создать сам
декал сразу нужного размера, единственное что - использовать подложку из текущего видового окна следует правильно. Растянуть до итогого размера. Причем
если видовое окно размещает реальный рендер по центру и мы получаем поля, эти поля должны быть учтены и сам декал следует выравнить с соблюдением таких же
полей.

 Наличие полей в окне моби. Это приводит к тому, что добавлять новые глобальные текстуры и переводить в них картинку, но это означает что
переводить или копировать придется включая и Sampling data.
 Другое дело - решить малой кровью. У нас есть картинка, мы знаем offset (renderX, renderY), т.е. вычисляем реальную рамку внутри картинки. Далее наша задача в случае сохранения картинки из общей картинки извлечь нужную нам часть. Когда рисуем обратно фильтром, т.е. текстуру подгоняем под внутренний размер. Это обеспечить стабильность эффекта при одинаковом aspect ratio не зависимо от размера.

+ Также наши renderX и renderY нам нужны чтобы исправить баг с объемным туманом, когда мы извлекаем 3д позицию.

scene000_sunGlasses не работает, вылетает с ошибкой драйвера... хм, к чему бы это ?!
 Что-то связано с рендером и подготовкой кадра.
+ Временное решение - открывать сцены с активным schematic view

05.11.16

+ prepare property views for main composition components
+ 3d decals filter
	- bridge to photoshop
	- bindless textures for each decal texture
	- connect to story track ?!

+ 3d fog and volume subroutines for blend modes

+ 3d FOG VOLUME 
	+ test why sometimes it slides and moves when camera move
		проблему обнаружил, нужно учитывать размеры полей при aspect ratio в видовом окне
	+ test volume object in LOG depth !!

--------------------------------------

+ 3d DOF
	+ make a fast preview mode (use a pre-rendered downsized blured image)
!!! DOF don't like infinite camera Far Plane values !!!
	- calibrate DOF behaviour
- blur for the same size and blur for the downsample
+ check 3d fog alpha texture (doesn't work with volumes)

+ put volume objects into composition tree UI
+ normal blend mode doesn't work
	NeedProgramReload flag was without initialization
	recreate shader object before recompilation
+ check the 2 lights, checkboxes on/off
	added check for non-light connected plug, possible to do that by UI

- check the save / merge
+ override display resolution to add into global settings

== в скриптах, в UI ==

 - refresh очень часто не обрабатывается, на некоторых операциях, на загрузке сцены или создании новой

 + не перетаскивается освещение на композицию
 нет подписей для композиций и элементов
  + какая текущая, какая использует маску
 +- не работает копирование
+	для копирования возможно потребуется FBPropertyColorAndAlpha заменить
 + нет сохранения композиций
	реализовал в виде возможности выбрать все компонеты, а далее Save Selected As...
 
 + добавил фильтрацию отображаемых композиций

+ не используется выбор между Copy или Move действия перетаскивания компоненты

+ возможно может пригодится смена порядка самих композиций. Например когда одна композиция использует результат другой. Для этого хорошо бы чтобы другая успела выполнить визуализацию

 не работает окно предварительно просмотра и нет возможности просмотреть что в каждой
 стадии по отдельности получается

== для композиции в общем ==

- добавить поддержку выбранного качества буфера глубины !

+ в случае рендера следует отключать режим превью
- и возможно менять качество картинки, если render override

?! - нужно ли добавить возможность эксклюзивных групп в композиции

+ Если композиция значится как viewportoutput и при этом привязана к неактивной камере,
 нет смысла её визуализировать ! Это очень расточительно
 На текущую камеру может воздействовать только одна, первая по списку композиция
	Добавил такую возможность, а также свойство Render Only Current для настроек графики,
	на случай визуализации всех без разбора композиций

 Рендер в offline buffer
+  Моби не даёт возможность подменить framebuffer, поэтому нужно рендерить именно в тот,
 что устанавливается программой. Теперь по поводу multisamples. Если мои глобал сеттинг
 настроена на сэмплы, а в моби их нет или наоборот, что делать в этом случае.
 Можно попробовать подменять именно под мои настройки и игнорировать то что находится в моби
		Попробовал, если подменить на сэмплированные текстуры, то выдается ошибка ReadPixels
		Это означает, что настройки следует брать из тех что заданы моби, единственно что можно
		попробовать задать своё кол-во сэмплов и coverage сэмплов !

!!! Глюк. Картинка сбилась когда у камеры установил Picture Format - HD и Window Resolution, or Aspect
 Что-то в размерах неверно считается думаю

!!! Глюк. При сочетании списка освещения в композиции и шейдере, получил краш !!!
 Краш исправил, но логика всё еще работает неверно, нужно переосмыслить.

 Шейдер должен отлавливать глобальные события
 + изменение контекста
 + изменение настроек графики - мультисэмплинг, кол-во сэмплов, тип хранения глубины (логарифмическое / линейное)

+ 1) провести тесты разных вариантов рендера
+ 2) не передается значение multisampling samples в шейдеры
+ 3) в фильтрах не подключено разветвление для текстуры глубины

+ Еще одна проблема связана с обратной совместимостью новой и старой шейдерной модели. По сути в сцене может остаться огромное кол-во мусора от старых настроек и было бы неплохо от него избавиться. Либо какой-то скрипт, который будет зачищать, либо поменять типы и классы данных, чтобы небыло пересечений со старой системой !

менеджер шейдеров не очищается при новой сцене или загрузке файлов, так за несколько
файлов может накопиться слишком много мусора

изменение списка источников света для композиции, будет ли обновляться для шейдера ?
 Это касательно ситуации когда шейдер имеет свои внутренние освещения в добавок к списку композиции
 Можно добавить флаг, будет ли композиция перекрывать эклюзивный список шейдера

 GPU Cache никак не реагирует на эксклюзивный список освещения композиции

 с низким приоритетом, не работает batch texture processing

 == в шейдерах ==

- не все шейдеры используют разное содержание буфера глубины - лог, инвертированный диапазон

-  1) не работает фильтр глубины резкости
 
  2) halftone тоже вышел какой-то косячный

  3) 3d fog volume не работает в режиме отображения x-ray
   так же положение съезжает при узком видовом окне (layout - custom_scripting)

 все фильтра используют процессинг одного размера
 #define SAME_SIZE
 Возможно данный дефайн можно упразнить для фильтров

 только outlines использует чтение мультисэмпл данных
 #define USE_MS
 #define SAMPLES 4

 шейдеры не различают хранение данных в буфере глубины, следует использовать
 #define DEPTH_LOG
 #define DEPTH_NV


 == в документации ==

 список всех авто дефайнов

 outputTexelSize (outputSize)
 renderTexelSize
 renderSize

 maskInverse
 weight

 cameraNearPlane
 cameraFarPlane

 colorSampler
 depthSampler (sampler2D / sampler2DMS)
 normalSampler (sampler2D / sampler2DMS)
 maskSampler (sampler2D / sampler2DMS)

 Последние различаются в записимости от того поддерживает ли шейдер мультисемплинг и включен ли мультисемплинг в настройках